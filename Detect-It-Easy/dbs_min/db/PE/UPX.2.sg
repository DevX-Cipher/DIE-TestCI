function isPatchedUPX(){var e,t=0,i=PE.getNumberOfImportThunks(0)
return t=1<i&&i<7&&PE.getSizeOfCode()&&PE.getSizeOfUninitializedData()&&2<PE.section.length&&0==PE.section[0].FileSize&&(e=0,"LoadLibraryA"==PE.getImportFunctionName(0,0)&&e++,"GetProcAddress"==PE.getImportFunctionName(0,1)&&e++,4==i&&("VirtualProtect"==PE.getImportFunctionName(0,2)&&e++,"ExitProcess"==PE.getImportFunctionName(0,3))&&e++,3<=i&&e<4&&("ExitProcess"==PE.getImportFunctionName(0,2)||PE.isDll()&&"VirtualProtect"==PE.getImportFunctionName(0,2))&&e++,6==i&&("VirtualProtect"==PE.getImportFunctionName(0,2)&&e++,"VirtualAlloc"==PE.getImportFunctionName(0,3)&&e++,"VirtualFree"==PE.getImportFunctionName(0,4)&&e++,"ExitProcess"==PE.getImportFunctionName(0,5))&&e++,t=2==e&&2==i||3==e&&3<=i||4==e&&4==i||6==e&&6==i||t)&&4120==PE.getAddressOfEntryPoint()?!1:t}function getUPXOptions(e){var t=PE.readByte(e+2),e=PE.readByte(e+3),i=""
switch(t){case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:i="NRV"
break
case 14:i="LZMA"
break
case 15:i="zlib"}i&&(sOptions=sOptions.append(i),sOptions=8==e?sOptions.append("best"):sOptions.append("brute"))}function getUPXVersion(){var e=PE.findString(0,1024,"$Id: UPX "),t=PE.findString(0,1024,"UPX!");-1!=t&&getUPXOptions(t+4),(sVersion=(sVersion=-1!=e?PE.getString(e+9,4):sVersion)||-1==t?sVersion:PE.getString(t-5,4))&&+sVersion.toString()!=sVersion&&(sVersion=PE.is64()?"3.91+":"0.89+",sOptions="modified")}function detect(){if(!PE.isNet())return PE.is64()?PE.compareEP("53565755488D35........488DBE........57",PE.compareEP("4889")?24:0)&&(bDetected=!0):PE.compareEP("60BE........8DBE........57",PE.compareEP("807C")?27:0)?bDetected=!0:PE.compareEP("60e8000000005883e8..508db8........578db0........83cd..31db9090909001db75")&&(sVersion="0.70",bDetected=!0),getUPXVersion(),(bDetected=sVersion?!0:bDetected)?sVersion?PE.isSectionNamePresent("UPX0")||(sOptions=sOptions.append("modified")):(PE.is64()&&(sVersion="3.91+"),sOptions="modified"):bDetected=isPatchedUPX(),result()}init("packer","UPX")
